{%- liquid
  assign container_width = section.settings.container_width

  case section.settings.container_spacer_type
    when 'margin'
      assign container_spacer_class = 'my-8 lg:my-12'
    when 'padding'
      assign container_spacer_class = 'py-8 lg:py-12'
    else
      assign container_spacer_class = ''
  endcase
-%}

<section
  class="w-full color-{{ section.settings.color_scheme }} gradient"
  role="region"
  aria-label="{{ section.settings.heading | strip_html }}"
  {% if section.settings.section_id != blank %}
    id="{{ section.settings.section_id | handleize }}"
  {% endif %}
>
  <div class="c-container {% if container_width == 'wide' %} wide {% endif %} flex flex-col gap-y-5 md:gap-y-8 {{ container_spacer_class }}">
    {%- if section.settings.heading != blank -%}
      <h2 class="h2 text-center">{{ section.settings.heading }}</h2>
    {%- endif -%}

    {%- if section.settings.description != blank -%}
      <div class="body-2 text-center">{{ section.settings.description }}</div>
    {%- endif -%}

    <ul class="flex flex-col">
      {%- for block in section.blocks -%}
        {%- liquid
          assign is_expanded = false
          if section.settings.open_first_collapsible_row and forloop.first
            assign is_expanded = true
          endif
        -%}

        <li
          class="py-5 border-y border-y-gray-300"
          {{ block.shopify_attributes }}
          x-data="{ expanded: {{ is_expanded | json }} }"
        >
          <button
            type="button"
            x-on:click="expanded = !expanded"
            class="w-full flex flex-row justify-between items-center gap-4"
            aria-controls="collapsibleItem-{{ section.index }}-{{ forloop.index }}"
            :aria-expanded="expanded ? 'true' : 'false'"
          >
            <h3 class="h5 richtext text-left">
              {{- block.settings.heading | default: block.settings.page.title | escape -}}
            </h3>

            <span
              class="transition-transform px-4"
              :class="{ 'rotate-180': expanded }"
            >
              {%- render 'icon-caret' -%}
            </span>
          </button>

          <div
            class="w-full"
            {% if is_expanded == false %}
              style="display: none;"
            {% endif %}
            x-show="expanded"
            x-collapse
            id="collapsibleItem-{{ section.index }}-{{ forloop.index }}"
            role="region"
            aria-label="{{ block.settings.heading | default: block.settings.page.title | escape }}"
          >
            <div class="w-full pt-5 richtext body-4">
              {{- block.settings.content -}}
              {{- block.settings.page.content -}}
            </div>
          </div>
        </li>
      {%- endfor -%}
    </ul>
  </div>
</section>

{% schema %}
{
  "name": "Collapsible content",
  "disabled_on": {
    "groups": ["header"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Container"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "wide",
          "label": "Wide"
        }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "container_spacer_type",
      "label": "Container spacer type",
      "options": [
        {
          "value": "margin",
          "label": "Margin"
        },
        {
          "value": "padding",
          "label": "Padding"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "padding"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Title",
      "default": "Collapsible Content"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ipsum, tempora.</p>"
    },
    {
      "type": "header",
      "content": "Settings"
    },
    {
      "type": "checkbox",
      "id": "open_first_collapsible_row",
      "label": "Open first collapsible row",
      "default": true
    },
    {
      "type": "header",
      "content": "SECTION"
    },
    {
      "type": "text",
      "id": "section_id",
      "label": "Section ID",
      "info": "To refer to this section you must place #your-section-id in the internal reference links",
      "placeholder": "your-section-id"
    }
  ],
  "blocks": [
    {
      "type": "collapsible_row",
      "name": "Collapsible row",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "default": "Collapsible row",
          "label": "Heading"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsa iste porro, inventore perferendis nam impedit facere ea adipisci autem iusto ratione doloremque repellat, asperiores, cum eligendi itaque necessitatibus mollitia commodi.</p>"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Row content from page"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collapsible content",
      "blocks": [
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "Excepteur sint occaecat cupidatat non proident"
          }
        },
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur"
          }
        },
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "Lorem ipsum dolor sit amet consectetur adipisicing elit"
          }
        },
        {
          "type": "collapsible_row",
          "settings": {
            "heading": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua"
          }
        }
      ]
    }
  ]
}
{% endschema %}
