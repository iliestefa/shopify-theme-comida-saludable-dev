{%- assign container_width = section.settings.container_width -%}

{%- case section.settings.container_spacer_type -%}
  {%- when 'margin' -%}
    {%- assign container_spacer_class = 'my-8 lg:my-12' -%}
  {%- when 'padding' -%}
    {%- assign container_spacer_class = 'py-8 lg:py-12' -%}
  {%- else -%}
    {%- assign container_spacer_class = '' -%}
{%- endcase -%}

{%- assign active_feature = 1 -%}
{%- assign add_image_padding = false -%}
{%- for block in section.blocks -%}
  {%- if block.settings.position_y < 15 and block.settings.description_position contains 'bottom-' -%}
    {%- assign add_image_padding = true -%}
  {%- endif -%}
{%- endfor -%}

<section
  class="w-full color-{{ section.settings.color_scheme }} gradient"
  x-data="
    {
      active_feature: {{ active_feature }},
      setActiveFeature(value) {
        this.active_feature = value;
      },
      isActiveFeature(value) {
        return this.active_feature == value;
      }
    }
  "
  role="region"
  aria-label="{{ section.settings.heading | strip_html }}"
  {% if section.settings.section_id != blank %}
    id="{{ section.settings.section_id | handleize }}"
  {% endif %}
>
  <div class="c-container {% if container_width == 'wide' %} wide {% endif %} flex flex-col gap-y-5 md:gap-y-8 lg:gap-y-12 {{ container_spacer_class }}">
    {%- if section.settings.heading != blank -%}
      <h2 class="h2 text-center">{{ section.settings.heading }}</h2>
    {%- endif -%}

    <div class="flex flex-col gap-y-5 {% if add_image_padding %} md:pb-16 {% endif %}">
      <div class="relative w-full max-w-full md:max-w-[85%] lg:max-w-[70%] mx-auto">
        {%- assign main_image = section.settings.main_image -%}
        {%- if main_image != blank -%}
          {%- assign preload_image = false -%}
          {%- if section.index == 1 -%}
            {%- assign preload_image = true -%}
          {%- endif -%}

          {%- render 'image-element',
            class: 'w-full block',
            image: main_image,
            max_width: 1280,
            preload: preload_image
          -%}

        {%- else -%}
          <div class="w-full max-w-full">
            {{- 'detailed-apparel-1' | placeholder_svg_tag: 'w-full h-auto' -}}
          </div>
        {%- endif -%}

        {%- for block in section.blocks -%}
          {%- assign position_x = block.settings.position_x -%}
          {%- assign position_y = block.settings.position_y -%}
          <div
            class="absolute z-[1]"
            style="
              left: {{ position_x }}%;
              bottom: {{ position_y }}%;
              transform: translate(calc(-1 * {{ position_x }}%), {{ position_y }}%);
            "
          >
            <button
              type="button"
              class="
                absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2
                w-8 h-8 rounded-[50%] border-2 cursor-pointer
                flex justify-center items-center bg-white shadow-sm z-[1]
                {% if section.settings.show_markers_in_desktop == false %} lg:hidden {% endif %}
              "
              :class="
                {
                  'border-gray-600 shadow-gray-600': isActiveFeature({{ forloop.index }}),
                  'border-black': !isActiveFeature({{ forloop.index }})
                }
              "
              @click="setActiveFeature({{ forloop.index }})"
              @focus="setActiveFeature({{ forloop.index }})"
              @mouseover="setActiveFeature({{ forloop.index }})"
            >
              <span class="leading-[1] font-bold">+</span>
              <span class="sr-only">{{ block.settings.description | strip_html }}</span>
            </button>

            {%- if block.settings.description != blank -%}
              {%- assign description_position = block.settings.description_position -%}
              {%- assign description_primary_position = description_position | split: '-' | first -%}

              {%- assign conector_class = '' -%}
              {%- case description_primary_position -%}
                {%- when 'top' -%}
                  {%- assign conector_class = 'h-[80px] bottom-0 border-r-2' -%}
                {%- when 'right' -%}
                  {%- assign conector_class = 'w-[80px] left-0 border-t-2' -%}
                {%- when 'bottom' -%}
                  {%- assign conector_class = 'h-[80px] top-0 border-r-2' -%}
                {%- when 'left' -%}
                  {%- assign conector_class = 'w-[80px] right-0 border-t-2' -%}
              {%- endcase -%}
              <div class="absolute border-dotted border-gray-400 {{ conector_class }} lg-down:hidden"></div>

              {%- assign description_class = '' -%}
              {%- case description_position -%}
                {%- when 'top-left' -%}
                  {%- assign description_class = 'bottom-[80px] -right-2 text-right' -%}
                {%- when 'top-center' -%}
                  {%- assign description_class = 'bottom-[80px] left-1/2 transform -translate-x-1/2 text-center' -%}
                {%- when 'top-right' -%}
                  {%- assign description_class = 'bottom-[80px] -left-2' -%}
                {%- when 'right-top' -%}
                  {%- assign description_class = '-bottom-3 left-[80px] text-left' -%}
                {%- when 'right-center' -%}
                  {%- assign description_class = 'top-1/2 left-[80px] transform -translate-y-1/2 text-left' -%}
                {%- when 'right-bottom' -%}
                  {%- assign description_class = '-top-3 left-[80px] text-left' -%}
                {%- when 'bottom-left' -%}
                  {%- assign description_class = 'top-[80px] -right-2 text-right' -%}
                {%- when 'bottom-center' -%}
                  {%- assign description_class = 'top-[80px] left-1/2 transform -translate-x-1/2 text-center' -%}
                {%- when 'bottom-right' -%}
                  {%- assign description_class = 'top-[80px] -left-2' -%}
                {%- when 'left-top' -%}
                  {%- assign description_class = '-bottom-3 right-[80px] text-right' -%}
                {%- when 'left-center' -%}
                  {%- assign description_class = 'top-1/2 right-[80px] transform -translate-y-1/2 text-right' -%}
                {%- when 'left-bottom' -%}
                  {%- assign description_class = '-top-3 right-[80px] text-right' -%}
              {%- endcase -%}

              {%- assign max_width = 'max-w-[25vw]' -%}
              {%- if description_primary_position == 'top' or description_primary_position == 'bottom' -%}
                {%- assign max_width = 'max-w-[35vw]' -%}
              {%- endif -%}

              <div class="absolute w-[300px] {{ max_width }} flex flex-col gap-y-1 lg-down:hidden rounded-lg bg-slate-400/50 p-2.5 body-4 {{ description_class }}">
                {%- if block.settings.heading -%}
                  <h3 class="h6">{{ block.settings.heading }}</h3>
                {%- endif -%}

                {%- if block.settings.description != blank -%}
                  {{- block.settings.description -}}
                {%- endif -%}
              </div>
            {%- endif -%}
          </div>

          <div
            class="absolute border-dotted border-gray-400 border-r-2 lg:hidden"
            x-show="isActiveFeature({{ forloop.index }})"
            style="left: {{ position_x }}%; top: calc(100% - {{ position_y }}%); height: calc({{ position_y }}% + 25px);{% if active_feature != forloop.index %}display: none;{% endif %}"
          ></div>
        {%- endfor -%}
      </div>

      {%- for block in section.blocks -%}
        <div
          class="lg:hidden w-full flex flex-col gap-y-2 relative bg-gray-200 p-4 rounded-lg text-center"
          x-show="isActiveFeature({{ forloop.index }})"
          {% if active_feature != forloop.index %}
            style="display: none;"
          {% endif %}
        >
          {%- if block.settings.heading -%}
            <h3 class="h6">{{ block.settings.heading }}</h3>
          {%- endif -%}

          {%- if block.settings.description != blank -%}
            {{- block.settings.description -}}
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>

    {%- if section.settings.description != blank -%}
      <div class="body-1 text-center">{{ section.settings.description }}</div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Image & Coordinate Points",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Container"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-2"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "wide",
          "label": "Wide"
        }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "container_spacer_type",
      "label": "Container spacer type",
      "options": [
        {
          "value": "margin",
          "label": "Margin"
        },
        {
          "value": "padding",
          "label": "Padding"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "padding"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Title",
      "default": "Dynamic coordinates"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ipsum, tempora.</p>"
    },
    {
      "type": "header",
      "content": "Image",
      "info": "Recommended image size: 1680x1080px"
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Main Image",
      "info": "You can choose a dynamic image source as a product metafield."
    },
    {
      "type": "header",
      "content": "Settings"
    },
    {
      "type": "checkbox",
      "id": "show_markers_in_desktop",
      "label": "Show Markers in Desktop",
      "default": true
    },
    {
      "type": "header",
      "content": "SECTION"
    },
    {
      "type": "text",
      "id": "section_id",
      "label": "Section ID",
      "info": "To refer to this section you must place #your-section-id in the internal reference links",
      "placeholder": "your-section-id"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        {
          "type": "header",
          "content": "Position X Y",
          "info": "Adjust the percentage until you find the correct position"
        },
        {
          "type": "range",
          "id": "position_x",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50,
          "label": "Marker Position X"
        },
        {
          "type": "range",
          "id": "position_y",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50,
          "label": "Marker Position Y"
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "Heading",
          "default": "Feature title"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ipsum, tempora.</p>"
        },
        {
          "type": "select",
          "id": "description_position",
          "label": "Description Position",
          "options": [
            {
              "group": "Top",
              "value": "top-left",
              "label": "Top Left"
            },
            {
              "group": "Top",
              "value": "top-center",
              "label": "Top Center"
            },
            {
              "group": "Top",
              "value": "top-right",
              "label": "Top Right"
            },
            {
              "group": "Right",
              "value": "right-top",
              "label": "Right Top"
            },
            {
              "group": "Right",
              "value": "right-center",
              "label": "Right Center"
            },
            {
              "group": "Right",
              "value": "right-bottom",
              "label": "Right Bottom"
            },
            {
              "group": "Bottom",
              "value": "bottom-left",
              "label": "Bottom Left"
            },
            {
              "group": "Bottom",
              "value": "bottom-center",
              "label": "Bottom Center"
            },
            {
              "group": "Bottom",
              "value": "bottom-right",
              "label": "Bottom Right"
            },
            {
              "group": "Left",
              "value": "left-top",
              "label": "Left Top"
            },
            {
              "group": "Left",
              "value": "left-center",
              "label": "Left Center"
            },
            {
              "group": "Left",
              "value": "left-bottom",
              "label": "Left Bottom"
            }
          ],
          "default": "right-center"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image & Coordinate Points",
      "blocks": [
        {
          "type": "feature",
          "settings": {
            "position_x": 27,
            "position_y": 60,
            "heading": "Consectetur adipisicing",
            "description": "<p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ipsum, tempora.</p>",
            "description_position": "left-center"
          }
        },
        {
          "type": "feature",
          "settings": {
            "position_x": 40,
            "position_y": 35,
            "heading": "Laboris nisi ut aliquip",
            "description": "<p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>",
            "description_position": "bottom-right"
          }
        },
        {
          "type": "feature",
          "settings": {
            "position_x": 70,
            "position_y": 50,
            "heading": "Provident nostrum ",
            "description": "<p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Corporis magni veniam reiciendis, provident nostrum vero!</p>",
            "description_position": "right-center"
          }
        },
        {
          "type": "feature",
          "settings": {
            "position_x": 50,
            "position_y": 70,
            "heading": "Voluptate velit",
            "description": "<p>Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur.</p>",
            "description_position": "top-center"
          }
        }
      ]
    }
  ]
}
{% endschema %}
