{%- assign show_secondary_image = show_secondary_image | default: true, allow_false: true -%}
{%- assign priority = priority | default: false, allow_false: true -%}
{%- assign show_vendor = show_vendor | default: true, allow_false: true -%}
{%- assign quick_add = quick_add | default: 'none' -%}

<div class="flex flex-col w-full h-full rounded-[15px] border border-gray-300 border-opacity-80 relative overflow-hidden">
  <div class="flex flex-col">
    <a
      class="w-full pb-[100%] relative group overflow-hidden"
      href="{{ product.url }}"
    >
      {%- if product.featured_media -%}
        {%- render 'image-element',
          image: product.featured_image,
          max_width: 800,
          class: 'absolute inset-0 w-full h-full object-center object-cover',
          priority: priority
        -%}

        {%- if product.media[1] != null and show_secondary_image -%}
          {%- render 'image-element',
            image: product.media[1],
            max_width: 800,
            class: 'absolute inset-0 w-full h-full object-center object-cover opacity-0 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300'
          -%}
        {%- endif -%}
      {%- endif -%}
    </a>

    {%- assign show_badges = false -%}
    {%- if product.available == false or product.compare_at_price > product.price -%}
      {%- assign show_badges = true -%}
    {%- endif -%}

    {%- if show_badges -%}
      <div class="absolute top-5 left-0 w-full flex flex-row flex-wrap gap-4 px-5">
        {%- if product.available == false -%}
          <span class="rounded-full bg-red-600 text-white px-3 py-1 body-3">
            {{- 'products.product.sold_out' | t -}}
          </span>
        {%- elsif product.compare_at_price > product.price and product.available -%}
          <span class="bg-green-500 rounded-full text-white px-3 py-2 body-4 text-nowrap leading-[1]">
            {{- 'products.product.on_sale' | t -}}
          </span>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>

  <div class="flex flex-col justify-between gap-y-5 p-3 md:p-5 flex-1">
    <div class="flex flex-col gap-y-2">
      {%- if show_vendor -%}
        <div class="body-4 uppercase">
          <span class="sr-only">{{ 'accessibility.vendor' | t }}</span>
          <div class="span">{{ product.vendor }}</div>
        </div>
      {%- endif -%}

      <h3 class="h5">
        <a href="{{ product.url }}">
          {{- product.title | escape -}}
        </a>
      </h3>

      {%- render 'card-product-price', product: product -%}
    </div>

    {%- if quick_add == 'standard' -%}
      <div class="w-full">
        {%- liquid
          assign qty_rules = false
          if product.selected_or_first_available_variant.quantity_rule.min > 1 or product.selected_or_first_available_variant.quantity_rule.max != null or product.selected_or_first_available_variant.quantity_rule.increment > 1
            assign qty_rules = true
          endif
        -%}

        {%- if product.variants.size > 1 or qty_rules -%}
          <a
            href="{{ product.url }}"
            class="button-secondary"
          >
            {{- 'products.product.choose_options' | t -}}
          </a>
        {%- else -%}
          {%- form 'product', product, novalidate: 'novalidate' -%}
            <input
              type="hidden"
              name="id"
              value="{{ product.selected_or_first_available_variant.id }}"
              class="product-variant-id"
              {% if product.selected_or_first_available_variant.available == false %}
                disabled
              {% endif %}
            >

            <button
              type="submit"
              name="add"
              class="w-full button-primary js-add-to-cart"
              {% if product.selected_or_first_available_variant.available == false %}
                disabled
              {% endif %}
            >
              <span>
                {%- if product.selected_or_first_available_variant.available -%}
                  {{ 'products.product.add_to_cart' | t }}
                {%- else -%}
                  {{ 'products.product.sold_out' | t }}
                {%- endif -%}
              </span>
            </button>
          {%- endform -%}
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>
